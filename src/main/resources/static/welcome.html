<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Welcome</title>
    <style>
        /* Styling for the message popup */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            border: 1px solid #333;
            text-align: center;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>Welcome, <span id="usernameDisplay"></span>!</h1>
<button id="getInfoButton">Alert!!</button>

<h1>Message Sent to </h1>
<ul id="message-list">

</ul>
<script>
        // Function to extract the username from the URL parameters
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        var username = getParameterByName("username");
        var usernameDisplay = document.getElementById("usernameDisplay");
        usernameDisplay.textContent = username;

        // Add a click event listener to the button
        var getInfoButton = document.getElementById("getInfoButton");
        getInfoButton.addEventListener("click", function() {
            // Capture the username from the URL and use it in the GET request
            var url = "/alert?username=" + encodeURIComponent(username);

            // Perform the GET request
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Process the response data as needed

                    for (let i = 0; i <=data.length; i++) {
                             addMessage(data[i]);
                    }
                })
                .catch(error => {
                    alert("Error: " + error);
                });
        });

        function addMessage(newMessage) {
            const messageList = document.getElementById("message-list");
            //const newMessage = prompt("Enter a message:");

            if (newMessage) {
                const listItem = document.createElement("li");
                listItem.textContent = "Message sent to Family Contact " + newMessage;
                messageList.appendChild(listItem);
            }
        }

    </script>
</body>
</html>